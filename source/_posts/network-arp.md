---
title: 网络协议---ARP协议
tags: protocol
categories: 计算机网络
abbrlink: 7f765bc8
date: 2019-08-12 17:13:12
---
# ARP地址解析协议

地址解析协议（ARP：Address Resolution Protocol），是一个通过解析网络层地址来寻找数据链路层地址的网络传输协议，即通过IP寻找MAC地址。

## 基本功能

    在以太网协议中规定，同一局域网中的一台主机要和另外一台主机进行直接通信，必须要知道目标主机的MAC地址。而在TCP/IP协议中，网络层和传输层只关心目标主机的IP地址。这就导致在以太网中使用IP协议是，数据链路层的以太网协议接到上层IP协议提供的数据中，只包含目标主机的IP。于是需要一种方法，根据目标主机的IP，获取其IP地址。这就是ARP协议要做的事情。所谓地址解析就是主机在发送帧前将目标IP地址转换成目标MAC地址的过程。

## 数据包结构

![arp](https://myblog-coolkaka.oss-cn-shanghai.aliyuncs.com/network/%E7%BD%91%E7%BB%9C%E5%8D%8F%E8%AE%AE---ARP%E5%8D%8F%E8%AE%AE.png)

## 原理

在每台安装有TCP/IP协议的计算机或者路由器里都有一个ARP缓存表，表里的IP地址与MAC地址是一一对应的。如下表所示。

| 主机 | IP  | MAC地址 |
| --- | --- | --- |
| A |192.168.38.10  |00-AA-00-62-D2-02  |
| B |192.168.38.11  | 00-BB-00-62-C2-02 |
| C |192.168.38.12  | 00-CC-00-62-C2-02 |
| D |192.168.38.13  | 00-DD-00-62-C2-02 |
| E |192.168.38.14	| 00-EE-00-62-C2-02 |
|... | ... | ... |

以主机A（192.168.38.10）向主机B（192.168.38.11）发送数据为例。

    1.当发送数据时，主机A会在自己的ARP缓存表中寻找是否有目标IP地址。如果找到就知道目标MAC地址为（00-BB-00-62-C2-02），直接把目标MAC地址写入帧里面发送就可。

    2.如果在ARP缓存表中没有找到相对应的IP地址，主机A就会在网络上发送一个广播（ARP request），目标MAC地址是"FF.FF.FF.FF.FF.FF"，这表示向同一网段内的所有主机发出这样的询问："192.168.38.11的MAC地址是什么？"

    3.网络上其他主机并不响应ARP询问，只有主机B接收到这个帧时，才向主机A做出这样的回应（ARP response）："192.168.38.11的MAC地址是00-BB-00-62-C2-02"，此回应以单播方式。这样，主机A就知道主机B的MAC地址，它就可以向主机B发送信息。同时它还更新自己的ARP高速缓存（ARP cache），下次再向主机B发送信息时，直接从ARP缓存表里查找就可。

ARP缓存表采用老化机制，在一段时间内如果表中的某一行没有使用，就会被删除，这样可减少缓存表的长度，加快查询速度。

免费ARP（gratuitous ARP），它是指主机发送ARP查询（广播）自己的IP地址，当ARP功能被开启或者是端口初始配置完成，主机向网络发送免费ARP来查询自己的IP地址确认地址唯一可用。

作用：

1. 确定网络中是否有其他主机使用了IP地址，如果有应答则产生错误消息。

2. 免费ARP可以做更新ARP缓存用，网络中的其他主机收到该广播则在缓存中更新条目，收到该广播的主机无论是否存在与IP地址相关的条目都会强制更新，如果存在旧条目则会将MAC更新为广播包中的MAC。
